// ▓█████▄  ▒█████   ███▄    █ ▄▄▄█████▓    ██▓     ▒█████   ▒█████   ██ ▄█▀    ▄▄▄     ▄▄▄█████▓    ███▄ ▄███▓▓██   ██▓    ▄▄▄██▀▀▀██████     ██▓███   ██▓    ▓█████ ▄▄▄        ██████ ▓█████     ██▓    ▄▄▄▄   ▓█████   ▄████     █    ██ 
// ▒██▀ ██▌▒██▒  ██▒ ██ ▀█   █ ▓  ██▒ ▓▒   ▓██▒    ▒██▒  ██▒▒██▒  ██▒ ██▄█▒    ▒████▄   ▓  ██▒ ▓▒   ▓██▒▀█▀ ██▒ ▒██  ██▒      ▒██ ▒██    ▒    ▓██░  ██▒▓██▒    ▓█   ▀▒████▄    ▒██    ▒ ▓█   ▀    ▓██▒   ▓█████▄ ▓█   ▀  ██▒ ▀█▒    ██  ▓██▒
// ░██   █▌▒██░  ██▒▓██  ▀█ ██▒▒ ▓██░ ▒░   ▒██░    ▒██░  ██▒▒██░  ██▒▓███▄░    ▒██  ▀█▄ ▒ ▓██░ ▒░   ▓██    ▓██░  ▒██ ██░      ░██ ░ ▓██▄      ▓██░ ██▓▒▒██░    ▒███  ▒██  ▀█▄  ░ ▓██▄   ▒███      ▒██▒   ▒██▒ ▄██▒███   ▒██░▄▄▄░   ▓██  ▒██░
// ░▓█▄   ▌▒██   ██░▓██▒  ▐▌██▒░ ▓██▓ ░    ▒██░    ▒██   ██░▒██   ██░▓██ █▄    ░██▄▄▄▄██░ ▓██▓ ░    ▒██    ▒██   ░ ▐██▓░   ▓██▄██▓  ▒   ██▒   ▒██▄█▓▒ ▒▒██░    ▒▓█  ▄░██▄▄▄▄██   ▒   ██▒▒▓█  ▄    ░██░   ▒██░█▀  ▒▓█  ▄ ░▓█  ██▓   ▓▓█  ░██░
// ░▒████▓ ░ ████▓▒░▒██░   ▓██░  ▒██▒ ░    ░██████▒░ ████▓▒░░ ████▓▒░▒██▒ █▄    ▓█   ▓██▒ ▒██▒ ░    ▒██▒   ░██▒  ░ ██▒▓░    ▓███▒ ▒██████▒▒   ▒██▒ ░  ░░██████▒░▒████▒▓█   ▓██▒▒██████▒▒░▒████▒   ░██░   ░▓█  ▀█▓░▒████▒░▒▓███▀▒   ▒▒█████▓ 
//  ▒▒▓  ▒ ░ ▒░▒░▒░ ░ ▒░   ▒ ▒   ▒ ░░      ░ ▒░▓  ░░ ▒░▒░▒░ ░ ▒░▒░▒░ ▒ ▒▒ ▓▒    ▒▒   ▓▒█░ ▒ ░░      ░ ▒░   ░  ░   ██▒▒▒     ▒▓▒▒░ ▒ ▒▓▒ ▒ ░   ▒▓▒░ ░  ░░ ▒░▓  ░░░ ▒░ ░▒▒   ▓▒█░▒ ▒▓▒ ▒ ░░░ ▒░ ░   ░▓     ░▒▓███▀▒░░ ▒░ ░ ░▒   ▒    ░▒▓▒ ▒ ▒ 
//  ░ ▒  ▒   ░ ▒ ▒░ ░ ░░   ░ ▒░    ░       ░ ░ ▒  ░  ░ ▒ ▒░   ░ ▒ ▒░ ░ ░▒ ▒░     ▒   ▒▒ ░   ░       ░  ░      ░ ▓██ ░▒░     ▒ ░▒░ ░ ░▒  ░ ░   ░▒ ░     ░ ░ ▒  ░ ░ ░  ░ ▒   ▒▒ ░░ ░▒  ░ ░ ░ ░  ░    ▒ ░   ▒░▒   ░  ░ ░  ░  ░   ░    ░░▒░ ░ ░ 
//  ░ ░  ░ ░ ░ ░ ▒     ░   ░ ░   ░           ░ ░   ░ ░ ░ ▒  ░  ░ ░ ▒  ░ ░░ ░      ░   ▒    ░         ░      ░    ▒ ▒ ░░      ░ ░ ░ ░  ░  ░     ░░         ░ ░      ░    ░   ▒   ░  ░  ░     ░       ▒ ░    ░    ░    ░   ░ ░   ░     ░░░ ░ ░ 
//    ░        ░ ░           ░                 ░  ░    ░ ░      ░ ░  ░  ░            ░  ░                  ░    ░ ░         ░   ░       ░                  ░  ░   ░  ░     ░  ░      ░     ░  ░    ░      ░         ░  ░      ░       ░     
//  ░                                                                                                           ░ ░                                                                                            ░                            



let template = document.getElementById("template");
let container = document.getElementById("items");
let counter = 257;

const promise = new Promise((resolve, reject) => {
    var Airtable = require('airtable');
    var base = new Airtable({apiKey: 'pat56tfP2XEHesKmi.26e076d65e5d850669b7535104b874ded3100bbcfac74a895caf6999eb8b4c15'}).base('appjAt0R0NzejkdO3');

    base('collection').select({
        // maxRecords: 3,
        view: "Grid view"
    }).eachPage(async function page(records, fetchNextPage) {
        // This function (`page`) will get called for each page of records.

        records.forEach(function(record) {
            console.log(record.get('photo')[0].url);

            let templateCopy = template.cloneNode(true);
            container.appendChild(templateCopy);

            templateCopy.querySelector(".title").append(record.get('name'));
            templateCopy.querySelector('img').src = record.get('photo')[0].url; //i don't remember what the exact airtable object looks like for an attachment, 
                                                                                //but future aarya if you are referencing this code, you did this for a reason, and tested it.
                                                                                //the array reference to the first item is necessary to get the url, so ignore the uncaught TypeError
                                                                                //the code should work without resolving that.
            if (record.get('category') == "desi"){
                templateCopy.querySelector(".image").setAttribute("style", "-webkit-filter: drop-shadow(0px 0px 5px goldenrod);");

            }else if (record.get('category') == "me"){
                templateCopy.querySelector(".image").setAttribute("style", "-webkit-filter: drop-shadow(0px 0px 5px hotpink);");

            }else if (record.get('category') == "kathak"){
                templateCopy.querySelector(".image").setAttribute("style", "-webkit-filter: drop-shadow(0px 0px 5px coral);");

            }else if (record.get('category') == "singapore"){
                templateCopy.querySelector(".image").setAttribute("style", "-webkit-filter: drop-shadow(0px 0px 5px crimson);");

            }else if (record.get('category') == "labor"){
                templateCopy.querySelector(".image").setAttribute("style", "-webkit-filter: drop-shadow(0px 0px 5px blue);");

            }else if (record.get('category') == "nyc"){
                templateCopy.querySelector(".image").setAttribute("style", "-webkit-filter: drop-shadow(0px 0px 5px chartreuse);");

            }else if (record.get('category') == "family"){
                templateCopy.querySelector(".image").setAttribute("style", "-webkit-filter: drop-shadow(0px 0px 5px darkorchid);");

            }else if (record.get('category') == "friends"){
                templateCopy.querySelector(".image").setAttribute("style", "-webkit-filter: drop-shadow(0px 0px 5px teal);");

            }
            let docSource = templateCopy.querySelector("#source");
            let docSourceContainer = templateCopy.querySelector("#sourceContainer");
            let src = record.get('source');
            // console.log(src.length);
            if(src !== "..."){
                docSource.setAttribute("href", record.get('source'));
                docSource.append(src);
            }else if (src === "..."){
                docSourceContainer.append("from my albums");
                docSourceContainer.style.textDecoration = "none";
                docSourceContainer.style.color = "black";
            }

            templateCopy.querySelector(".desc").append(record.get('desc'));
            templateCopy.removeAttribute('id');

            templateCopy.style.left = getPosX();
            templateCopy.style.top = getPosY();

            templateCopy.classList.add("draggable");

            console.log('Retrieved', record.get('name'), ' dragging now.');
            dragElement(templateCopy);
        });

        // To fetch the next page of records, call `fetchNextPage`.
        // If there are more records, `page` will get called again.
        // If there are no more records, `done` will get called.
        fetchNextPage();
    }, function done(err) {
        if (err) { console.error(err); return; }
    });

    function getPosX(){
    let posX = Math.floor(Math.random() * ((window.innerWidth - 100) - 30) + 30);
    return posX + "px";
    }

    function getPosY(){
        let posY = Math.floor(Math.random() * ((window.innerHeight*2 - 100) - 30) + 30);
        return posY + "px";
    }  
    
    resolve("promise was resolved!");
});

promise
  .then((result) => {
    console.log(result); // "The promise was resolved!"
  })
  .catch((error) => {
    console.log(error); // "The promise was rejected!"
  });

/***************************************************************************************
    Title: JavaScript - How to make multiple divs draggable and movable across the website
    Author: user6439507
    Date: June 4, 2019
    Availability: https://stackoverflow.com/questions/51409650/javascript-how-to-make-multiple-divs-draggable-and-movable-across-the-website

    The code below is modified from the above link to make it work for my project.
***************************************************************************************/

function dragElement(elmnt) {
  elmnt.setAttribute.zIndex = counter;
  counter++;
  console.log(counter);
  var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
  if (document.getElementById(elmnt.id + "header")) {
    // if present, the header is where you move the DIV from:
    document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
  } else {
    // otherwise, move the DIV from anywhere inside the DIV:
    elmnt.onmousedown = dragMouseDown;
  }

  function dragMouseDown(e) {
    e = e || window.event;
    e.preventDefault();
    // get the mouse cursor position at startup:
    pos3 = e.clientX;
    pos4 = e.clientY;
    document.onmouseup = closeDragElement;
    // call a function whenever the cursor moves:
    document.onmousemove = elementDrag;
  }

  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    // set the element's new position:
    elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
    elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
  }

  function closeDragElement() {
    // stop moving when mouse button is released:
    document.onmouseup = null;
    document.onmousemove = null;
  }
}
/***************************************************************************************/